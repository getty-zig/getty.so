<!DOCTYPE html>
<!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<html>

  <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0021D8">

  <title>Customization</title>

  <link rel="canonical" href="https://getty.so/guide/customization/">
  <link rel="alternate" type="application/rss+xml" title="Getty" href="https://getty.so/feed.xml" />

  <link rel="stylesheet" href="/style.css">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
</head>


  <body>

    <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<header class="site-header">
  <div class="wrapper" style="text-align: center;">
    <a class="page-logo" href="/">
      <img src="/assets/images/page-logo.svg" alt="getty">
    </a>
  </div>
</header>


    <div class="container">
      <h1 id="customization">Customization</h1>

<p>So far, Getty has taken care of all of the little (de)serialization details for us behind the scenes. But sometimes, you just need to do things yourself. That’s where Getty’s customization features come in.</p>

<p>Getty allows both users and (de)serializers to customize the (de)serialization process for types that you’ve defined yourself, as well as types that you didn’t define (such as those in the standard library). Moreover, the customization enabled by Getty can be used in a local manner. That is, you can serialize a <code class="language-plaintext highlighter-rouge">bool</code> value as a <em>String</em> in one function and as an <em>Integer</em> in another, all without having to convert the value to a new or intermediate type.</p>

<h2 id="overview">Overview</h2>

<p>Customization in Getty revolves around <a href="/blocks-and-tuples">Blocks and Tuples (BT)</a>. I encourage you to take a few minutes to read up on them before continuing on. In any case, once you’ve defined a BT, you can pass it on to Getty via the <a href="https://docs.getty.so/#root;Serializer"><code class="language-plaintext highlighter-rouge">getty.Serializer</code></a> or <a href="https://docs.getty.so/#root;Deserializer"><code class="language-plaintext highlighter-rouge">getty.Deserializer</code></a> interfaces.</p>

<h3 id="out-of-band-customization">Out-of-Band Customization</h3>

<p>Here, we define and use a block that serializes <code class="language-plaintext highlighter-rouge">bool</code> values as Getty Integers.</p>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="k">const</span> <span class="n">std</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"std"</span><span class="p">);</span>
<span class="k">const</span> <span class="n">getty</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"getty"</span><span class="p">);</span>

<span class="k">const</span> <span class="n">block</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="k">bool</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span> <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span> <span class="p">{</span>
        <span class="k">const</span> <span class="n">v</span><span class="p">:</span> <span class="kt">i32</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">serializer</span><span class="p">.</span><span class="nf">serializeInt</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span> <span class="n">Serializer</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">usingnamespace</span> <span class="n">getty</span><span class="p">.</span><span class="nf">Serializer</span><span class="p">(</span>
        <span class="nb">@This</span><span class="p">(),</span>
        <span class="n">Ok</span><span class="p">,</span>
        <span class="n">Error</span><span class="p">,</span>
        <span class="n">block</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="o">.</span><span class="p">{</span> <span class="p">.</span><span class="py">serializeInt</span> <span class="o">=</span> <span class="n">serializeInt</span> <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">const</span> <span class="n">Ok</span> <span class="o">=</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">Error</span> <span class="o">=</span> <span class="k">error</span><span class="p">{};</span>

    <span class="k">fn</span> <span class="n">serializeInt</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="o">.</span><span class="p">{</span><span class="n">value</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="k">anyerror</span><span class="o">!</span><span class="k">void</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">{}).</span><span class="nf">serializer</span><span class="p">();</span>

    <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>

    <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>
<span class="p">}</span></code></pre></figure>

</pre></div>

<div class="code-block"><div class="language-tag">Shell session</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span><span class="w"> </span>zig build run
<span class="go">1
0</span></code></pre></figure>

</pre></div>

<p>And here, we make <code class="language-plaintext highlighter-rouge">Serializer</code> generic over a BT to make customization even easier for us.</p>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="k">const</span> <span class="n">std</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"std"</span><span class="p">);</span>
<span class="k">const</span> <span class="n">getty</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"getty"</span><span class="p">);</span>

<span class="k">const</span> <span class="n">int_block</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="k">bool</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span> <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span> <span class="p">{</span>
        <span class="k">const</span> <span class="n">v</span><span class="p">:</span> <span class="kt">i32</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">serializer</span><span class="p">.</span><span class="nf">serializeInt</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span> <span class="n">string_block</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="k">bool</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span> <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span> <span class="p">{</span>
        <span class="k">const</span> <span class="n">v</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="s">"true"</span> <span class="k">else</span> <span class="s">"false"</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">serializer</span><span class="p">.</span><span class="nf">serializeString</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">fn</span> <span class="n">Serializer</span><span class="p">(</span><span class="k">comptime</span> <span class="n">user_sbt</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="k">type</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">struct</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">usingnamespace</span> <span class="n">getty</span><span class="p">.</span><span class="nf">Serializer</span><span class="p">(</span>
            <span class="nb">@This</span><span class="p">(),</span>
            <span class="n">Ok</span><span class="p">,</span>
            <span class="n">Error</span><span class="p">,</span>
            <span class="n">user_sbt</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="kc">null</span><span class="p">,</span>
            <span class="o">.</span><span class="p">{</span>
                <span class="p">.</span><span class="py">serializeInt</span> <span class="o">=</span> <span class="n">serializeInt</span><span class="p">,</span>
                <span class="p">.</span><span class="py">serializeString</span> <span class="o">=</span> <span class="n">serializeString</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">);</span>

        <span class="k">const</span> <span class="n">Ok</span> <span class="o">=</span> <span class="k">void</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">Error</span> <span class="o">=</span> <span class="k">error</span><span class="p">{};</span>

        <span class="k">fn</span> <span class="n">serializeInt</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
            <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="o">.</span><span class="p">{</span><span class="n">value</span><span class="p">});</span>
        <span class="p">}</span>

        <span class="k">fn</span> <span class="n">serializeString</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
            <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">{s}</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{</span><span class="n">value</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="k">anyerror</span><span class="o">!</span><span class="k">void</span> <span class="p">{</span>
    <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">(</span><span class="n">int_block</span><span class="p">){}).</span><span class="nf">serializer</span><span class="p">());</span>
    <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>

    <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">(</span><span class="n">string_block</span><span class="p">){}).</span><span class="nf">serializer</span><span class="p">());</span>
    <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>
<span class="p">}</span></code></pre></figure>

</pre></div>

<div class="code-block"><div class="language-tag">Shell session</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span><span class="w"> </span>zig build run
<span class="go">1
"true"</span></code></pre></figure>

</pre></div>

<h3 id="in-band-customization">In-Band Customization</h3>

<p>Out-of-band customization has its uses, such as when you want to customize a type that you didn’t define. However, there’s a more convenient way to do things for <code class="language-plaintext highlighter-rouge">struct</code>, <code class="language-plaintext highlighter-rouge">enum</code>, and <code class="language-plaintext highlighter-rouge">union</code> types that you did define yourself.</p>

<p>If you define a BT within a <code class="language-plaintext highlighter-rouge">struct</code>, <code class="language-plaintext highlighter-rouge">enum</code>, or <code class="language-plaintext highlighter-rouge">union</code>, Getty will automatically process it without you having to pass it in directly through a (de)serializer. Just make sure the BT is public and named either <code class="language-plaintext highlighter-rouge">@"getty.sbt"</code> or <code class="language-plaintext highlighter-rouge">@"getty.dbt"</code> (former for serialization, latter for deserialization).</p>

<p>For example, the following code defines a serialization block for <code class="language-plaintext highlighter-rouge">Point</code> within the actual type itself.</p>

<div class="code-block"><div class="language-tag">src/main.zig</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="k">const</span> <span class="n">std</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"std"</span><span class="p">);</span>
<span class="k">const</span> <span class="n">getty</span> <span class="o">=</span> <span class="nb">@import</span><span class="p">(</span><span class="s">"getty"</span><span class="p">);</span>

<span class="k">const</span> <span class="n">Point</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="kt">i32</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="kt">i32</span><span class="p">,</span>

    <span class="k">pub</span> <span class="k">const</span> <span class="o">@</span><span class="s">"getty.sbt"</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="n">Point</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">const</span> <span class="n">attributes</span> <span class="o">=</span> <span class="o">.</span><span class="p">{</span>
            <span class="p">.</span><span class="py">x</span> <span class="o">=</span> <span class="o">.</span><span class="p">{</span> <span class="p">.</span><span class="py">rename</span> <span class="o">=</span> <span class="s">"X"</span> <span class="p">},</span>
            <span class="p">.</span><span class="py">y</span> <span class="o">=</span> <span class="o">.</span><span class="p">{</span> <span class="p">.</span><span class="py">skip</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">},</span>
        <span class="p">};</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="k">const</span> <span class="n">Serializer</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">usingnamespace</span> <span class="n">getty</span><span class="p">.</span><span class="nf">Serializer</span><span class="p">(</span>
        <span class="nb">@This</span><span class="p">(),</span>
        <span class="n">Ok</span><span class="p">,</span>
        <span class="n">Error</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="kc">null</span><span class="p">,</span>
        <span class="n">Struct</span><span class="p">,</span>
        <span class="o">.</span><span class="p">{</span>
            <span class="p">.</span><span class="py">serializeInt</span> <span class="o">=</span> <span class="n">serializeInt</span><span class="p">,</span>
            <span class="p">.</span><span class="py">serializeString</span> <span class="o">=</span> <span class="n">serializeString</span><span class="p">,</span>
            <span class="p">.</span><span class="py">serializeStruct</span> <span class="o">=</span> <span class="n">serializeStruct</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">const</span> <span class="n">Ok</span> <span class="o">=</span> <span class="k">void</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">Error</span> <span class="o">=</span> <span class="k">error</span><span class="p">{};</span>

    <span class="k">fn</span> <span class="n">serializeInt</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="o">.</span><span class="p">{</span><span class="n">value</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">serializeString</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">{s}</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{</span><span class="n">value</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">serializeStruct</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="nb">@This</span><span class="p">(),</span> <span class="k">comptime</span> <span class="mi">_</span><span class="p">:</span> <span class="p">[]</span><span class="k">const</span> <span class="kt">u8</span><span class="p">,</span> <span class="mi">_</span><span class="p">:</span> <span class="kt">usize</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="n">Struct</span> <span class="p">{</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"{{"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>

        <span class="k">return</span> <span class="n">Struct</span><span class="p">{};</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span> <span class="n">Struct</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">first</span><span class="p">:</span> <span class="k">bool</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>

    <span class="k">pub</span> <span class="k">usingnamespace</span> <span class="n">getty</span><span class="p">.</span><span class="py">ser</span><span class="p">.</span><span class="nf">Structure</span><span class="p">(</span>
        <span class="o">*</span><span class="nb">@This</span><span class="p">(),</span>
        <span class="n">Ok</span><span class="p">,</span>
        <span class="n">Error</span><span class="p">,</span>
        <span class="o">.</span><span class="p">{</span>
            <span class="p">.</span><span class="py">serializeField</span> <span class="o">=</span> <span class="n">serializeField</span><span class="p">,</span>
            <span class="p">.</span><span class="py">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">const</span> <span class="n">Ok</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">.</span><span class="py">Ok</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">.</span><span class="py">Error</span><span class="p">;</span>

    <span class="k">fn</span> <span class="n">serializeField</span><span class="p">(</span><span class="n">self</span><span class="p">:</span> <span class="o">*</span><span class="nb">@This</span><span class="p">(),</span> <span class="k">comptime</span> <span class="n">key</span><span class="p">:</span> <span class="p">[]</span><span class="k">const</span> <span class="kt">u8</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="n">Error</span><span class="o">!</span><span class="k">void</span> <span class="p">{</span>
        <span class="c">// Serialize key.</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="py">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="kc">true</span> <span class="o">=&gt;</span> <span class="n">self</span><span class="p">.</span><span class="py">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
            <span class="kc">false</span> <span class="o">=&gt;</span> <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="o">.</span><span class="p">{}),</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">{}).</span><span class="nf">serializer</span><span class="p">());</span>

        <span class="c">// Serialize value.</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">": "</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>
        <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">{}).</span><span class="nf">serializer</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">end</span><span class="p">(</span><span class="mi">_</span><span class="p">:</span> <span class="o">*</span><span class="nb">@This</span><span class="p">())</span> <span class="n">Error</span><span class="o">!</span><span class="n">Ok</span> <span class="p">{</span>
        <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"}}"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="k">anyerror</span><span class="o">!</span><span class="k">void</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Point</span><span class="p">{</span> <span class="p">.</span><span class="py">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="py">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">};</span>
    <span class="k">const</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Serializer</span><span class="p">{}).</span><span class="nf">serializer</span><span class="p">();</span>

    <span class="k">try</span> <span class="n">getty</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="n">std</span><span class="p">.</span><span class="py">debug</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">.</span><span class="p">{});</span>
<span class="p">}</span></code></pre></figure>

</pre></div>

<div class="code-block"><div class="language-tag">Shell session</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">$</span><span class="w"> </span>zig build run
<span class="go">{"X": 1}</span></code></pre></figure>

</pre></div>

    </div>

    <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<footer class="site-footer">
  <p>&copy; 2022 Getty</p>
</footer>


  </body>

</html>
