<!--
  Customize blog posts.

  Basically, this is a modified version of the blog-post.html template.
  The only differences are that we hid the ToC (but keep its margins).
-->

<!--UNMODIFIED-->
{% extends "main.html" %}

<!--UNMODIFIED-->
{% import "partials/nav-item.html" as item with context %}

<!--
  Hide contents of ToC.

  This overrides the site_nav block used in main.html (defined in base.html). The
  only difference is that the ToC logic has been updated so that the contents are
  hidden but its margin still remains.
-->
{% block site_nav %}
{% if nav %}
  {% if page.meta and page.meta.hide %}
    {% set hidden = "hidden" if "navigation" in page.meta.hide %}
  {% endif %}
  <div
    class="md-sidebar md-sidebar--primary"
    data-md-component="sidebar"
    data-md-type="navigation"
    {{ hidden }}
  >
    <div class="md-sidebar__scrollwrap">
      <div class="md-sidebar__inner">
        {% include "partials/nav.html" %}
      </div>
    </div>
  </div>
{% endif %}

{% if "toc.integrate" not in features %}
  {% if page.meta and page.meta.hide %}
    {% set hidden = "hidden" if "toc" in page.meta.hide %}
  {% endif %}
  <div
    class="md-sidebar md-sidebar--secondary"
    data-md-component="sidebar"
    data-md-type="toc"
    {{ hidden }}
  >
  </div>
{% endif %}
{% endblock %}

<!--UNMODIFIED-->
{% block container %}
  <div class="md-content md-content--post" data-md-component="content">

    <!-- Sidebar -->
    <div
      class="md-sidebar md-sidebar--post"
      data-md-component="sidebar"
      data-md-type="navigation"
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav">

            <!-- Page authors -->
            {% if page.authors %}
              <div class="md-post__authors md-typeset">
                {% for author in page.authors %}
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="{{ author.avatar }}" alt="{{ author.name }}" />
                    </span>
                    <span class="md-profile__description">
                      <strong>{{ author.name }}</strong><br />
                      {{ author.description }}
                    </span>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            <!-- Page metadata -->
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__title">
                <div class="md-nav__link">
                  <span class="md-ellipsis">
                    {{ lang.t("blog.meta") }}
                  </span>
                </div>
              </li>

              <!-- Page date -->
              <li class="md-nav__item">
                <div class="md-nav__link">
                  {% include ".icons/material/calendar.svg" %}
                  <time datetime="{{ page.meta.date }}" class="md-ellipsis">
                    {{- page.meta.date_format -}}
                  </time>
                </div>
              </li>

              <!-- Page categories -->
              {% if page.categories %}
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    {% include ".icons/material/bookshelf.svg" %}
                    <span class="md-ellipsis">
                      {{ lang.t("blog.categories.in") }}
                      {% for category in page.categories %}
                        <a href="{{ category.url | url }}">
                          {{- category.title -}}
                        </a>
                        {%- if loop.revindex > 1 %}, {% endif -%}
                      {% endfor -%}
                    </span>
                  </div>
                </li>
              {% endif %}

              <!-- Page readtime -->
              {% if page.meta.readtime %}
                {% set time = page.meta.readtime %}
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    {% include ".icons/material/clock-outline.svg" %}
                    <span class="md-ellipsis">
                      {% if time == 1 %}
                        {{ lang.t("readtime.one") }}
                      {% else %}
                        {{ lang.t("readtime.other") | replace("#", time) }}
                      {% endif %}
                    </span>
                  </div>
                </li>
              {% endif %}
            </ul>

            <!-- Page links -->
            {% if page.links %}
              <ul class="md-nav__list">
                <li class="md-nav__item md-nav__title">
                  <div class="md-nav__link">
                    <span class="md-ellipsis">
                      {{ lang.t("blog.references") }}
                    </span>
                  </div>
                </li>

                <!-- Render page links -->
                {% for nav_item in page.links %}
                  {% set path = "__ref_" ~ loop.index %}
                  {{ item.render(nav_item, path, 1) }}
                {% endfor %}
              </ul>
            {% endif %}
          </nav>

          <!-- Table of contents, if integrated -->
          {% if "toc.integrate" in features %}
            {% include "partials/toc.html" %}
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Page content -->
    <article class="md-content__inner md-typeset">
      {% block content %}
        {% include "partials/content.html" %}
      {% endblock %}
    </article>
  </div>
{% endblock %}
