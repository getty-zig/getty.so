<!DOCTYPE html>
<!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<html>

  <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0021D8">

  <title>Serialization</title>

  <link rel="canonical" href="https://getty.so/guide/serialization/">
  <link rel="alternate" type="application/rss+xml" title="Getty" href="https://getty.so/feed.xml" />

  <link rel="stylesheet" href="/style.css">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
</head>


  <body>

    <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<header class="site-header">
  <div class="wrapper" style="text-align: center;">
    <a class="page-logo" href="/">
      <img src="/assets/images/page-logo.svg" alt="getty">
    </a>
  </div>
</header>


    <div class="container">
      <h1 id="serialization">Serialization</h1>

<p>Serialization in Getty is a relatively straightforward process, as can be seen in the figure below.</p>

<p><img alt="Serialization" src="/assets/images/serialization.svg" class="figure" /></p>

<p>The process begins whenever data is passed to Getty. Upon receiving data to serialize, Getty selects and executes a <em>Serialization Block</em>, serializing the data into its <em>serialization data model</em>. The resulting Getty value is then passed to a Getty serializer to be serialized once more into an output data format.</p>

<p>In this section of the guide, we’ll focus mainly on the first half of the serialization process:</p>

<p><img alt="Serialization (users)" src="/assets/images/serialization-left.svg" class="figure-small" /></p>

<h2 id="data-models">Data Models</h2>

<p>Getty has two <strong>data models</strong>: one for serialization and one for deserialization.</p>

<p>Each data model is a set of abstract types (e.g., Booleans, Integers, Strings, Sequences) that provide (de)serializers with a simple, consistent, and generic interface to (de)serialization. Basically, what that means is that a Getty serializer doesn’t have to know how to serialize all possible Zig types, just the ones in Getty’s serialization data model, which can greatly simplify the serializer’s implementation.</p>

<p>Most types within Getty’s data models have a corresponding Zig representation. For example, a Getty Boolean is just a <code class="language-plaintext highlighter-rouge">bool</code> and a Getty String is any valid Zig string (e.g., <code class="language-plaintext highlighter-rouge">[]u8</code>, <code class="language-plaintext highlighter-rouge">[]const u8</code>). Some types though, like Maps and Sequences, are a bit more complicated. But we’ll talk about those later.</p>

<h2 id="serialization-blocks">Serialization Blocks</h2>

<p>Upon receiving a value to serialize, Getty will select and execute a <strong>Serialization Block</strong>. Serialization Blocks are namespaces (<code class="language-plaintext highlighter-rouge">struct</code>s with no fields) that specify how to serialize a particular set of types into Getty’s serialization data model.</p>

<p>Getty defines Serialization Blocks for a number of common Zig data types, including integers, slices, structs, <code class="language-plaintext highlighter-rouge">std.ArrayList</code>, <code class="language-plaintext highlighter-rouge">std.StringHashMap</code>, and <a href="https://github.com/getty-zig/getty/tree/main/src/ser/blocks">more</a>. For these types, you don’t need to do anything special in order to serialize them. Just pass your data (and a serializer) to Getty and you’re good to go!</p>

<p>For types that aren’t supported by Getty out-of-the-box or in cases where Getty’s default serialization behavior is insufficient, you can write and use your own Serialization Block(s). Each block is simply a namespace that contains two functions: <code class="language-plaintext highlighter-rouge">is</code> and <code class="language-plaintext highlighter-rouge">serialize</code>. Both functions are defined below:</p>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="c">// Specifies the set of types that a Serialization Block applies to.</span>
<span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span></code></pre></figure>

</pre></div>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="c">// Specifies how to serialize the types a Serialization Block applies to.</span>
<span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span>
    <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span>
<span class="p">)</span> <span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Error</span><span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span></code></pre></figure>

</pre></div>

<p>For example, the following shows a Serialization Block that turns <code class="language-plaintext highlighter-rouge">bool</code> values into Getty Booleans:</p>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="k">const</span> <span class="n">bool_sb</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="k">bool</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span> <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">serializer</span><span class="p">.</span><span class="nf">serializeBool</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

</pre></div>

<p>And here’s a Serialization Block that turns <code class="language-plaintext highlighter-rouge">bool</code> values into Getty Strings:</p>

<div class="code-block"><div class="language-tag">Zig code</div><pre class="code-block-inner">

<figure class="highlight"><pre><code class="language-zig" data-lang="zig"><span class="k">const</span> <span class="n">string_sb</span> <span class="o">=</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="n">is</span><span class="p">(</span><span class="k">comptime</span> <span class="n">T</span><span class="p">:</span> <span class="k">type</span><span class="p">)</span> <span class="k">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">T</span> <span class="o">==</span> <span class="k">bool</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">anytype</span><span class="p">,</span> <span class="n">serializer</span><span class="p">:</span> <span class="n">anytype</span><span class="p">)</span> <span class="o">!</span><span class="nb">@TypeOf</span><span class="p">(</span><span class="n">serializer</span><span class="p">).</span><span class="py">Ok</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">serializer</span><span class="p">.</span><span class="nf">serializeString</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="s">"true"</span> <span class="k">else</span> <span class="s">"false"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

</pre></div>

<p>We’ll look deeper into Serialization Blocks later on in the guide, so don’t worry too much about them.
For now, let’s move on to the second half of the serialization process in Getty: serializers!</p>

    </div>

    <!-- SPDX-License-Identifier: LGPL-2.1-or-later -->

<footer class="site-footer">
  <p>&copy; 2022 Getty</p>
</footer>


  </body>

</html>
